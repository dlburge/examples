/*! SL.comparaison.annonces 03-06-2015 */
var SelogerUI=SelogerUI||{};Array.prototype.totalForProperty=function(a){for(var b=0,c=0,d=this.length;d>c;c++)b+=this[c][a];return b},SelogerUI.AreaValues=function(a,b,c,d,e){this.values=a,this.label=e,this.color=b(c),this.id="area_"+d},SelogerUI.Axis=function(a,b,c,d,e){this.label=a,this.values=c,this.color=d,this.length=e,this.id="axis-"+b,this.init()},SelogerUI.Axis.prototype.init=function(){this.values=this.values.map(function(a){return isNaN(a)?parseFloat(a.replace(/\ /g,"")):parseFloat(a)}).sort(d3.ascending),this.min=0,this.max=this.values[this.values.length-1]},SelogerUI.Axis.prototype.scale=function(a){var b=d3.scale.linear().domain([this.min,this.max]).range([0,this.length]);return b(a)},SelogerUI.RadarChart=function(a){var b,c,d,e,f,g=[],h=[],i=a.scale.category10(),j={canvasWidth:600,canvasHeight:600,canvasPadding:35,axisColor:"#000",nodeColor:"#222",areaStrokeWidth:"3px",nodeRadius:3.5,radians:2*Math.PI,polyOpacity:.5,polyOpacityOff:.1,polyOpacityOn:.7},k=function(){l(),m(),n()},l=function(){c=b.append("svg:g").attr("id","canvas"),c.attr("transform","translate("+j.canvasWidth/2+" ,"+j.canvasHeight/2+")")},m=function(){var a=c.selectAll(".axis").data(h).enter().append("svg:g").attr("transform",function(a,b){return"rotate("+(360*(b/h.length)-90)+")translate("+a.scale(a.max)+")"}).attr("class","axis");a.append("svg:line").attr("x2",function(a){return-1*a.scale(a.max)}).style("stroke",function(a){return a.color}).style("fill","none"),a.append("svg:text").text(function(a){return a.label}).attr("text-anchor",function(a,b){var c=360*(b/h.length);return 0===c||180===c?"middle":0>c||c>180?"end":"start"}).attr("dy",function(a,b){var c=360*(b/h.length);return 90>c||c>270?"-1.00em":"1.25em"}).attr("transform",function(a,b){return"rotate("+-1*(360*(b/h.length)-90)+")"})},n=function(){var b=c.selectAll(".values").data(g).enter().append("svg:g").attr("class","values").attr("id",function(a){return a.id});b.append("svg:path").attr("class","lines").style("fill",function(a){return a.color}).style("stroke",function(a){return a.color}).style("fill-opacity",j.polyOpacity).style("stroke-width",j.areaStrokeWidth).on("mouseover",function(){c.selectAll("path").transition(200).style("fill-opacity",j.polyOpacityOff);var b=a.select(this),d=a.select(this.parentElement),e=d.selectAll(".nodeValue"),f=d.selectAll(".nodeLabel");b.transition(200).style("fill-opacity",j.polyOpacityOn),e.transition(200).style("fill-opacity",1),f.transition(200).style("fill-opacity",1)}).on("mouseout",function(){c.selectAll("path").transition(200).style("fill-opacity",j.polyOpacity);var b=a.select(this.parentElement),d=b.selectAll(".nodeValue"),e=b.selectAll(".nodeLabel");d.transition(400).style("fill-opacity",0),e.transition(400).style("fill-opacity",0)}).data(g.map(function(a){return a.values})).attr("d",a.svg.line.radial().radius(function(a){return a.scaledValue}).angle(function(a,b){return b===h.length&&(b=0),2*(b/h.length)*Math.PI}).interpolate("cardinal-closed"));var d,e,f=b.append("svg:g").attr("class","nodes").attr("transform","rotate(180)");f.selectAll(".nodeValue").data(function(a){return a.values.map(function(a){return a.scaledValue})}).enter().append("svg:circle").attr("class","nodeValue").attr("cx",function(a,b){return d=-(a*Math.sin(b*(j.radians/h.length)))}).attr("cy",function(a,b){return e=a*Math.cos(b*j.radians/h.length)}).attr("r",j.nodeRadius).style("fill",j.nodeColor).style("fill-opacity",0);var i,k;f.selectAll(".nodeLabel").data(function(a){return a.values.map(function(a){return a})}).enter().append("svg:text").attr("class","nodeLabel").attr("x",function(a,b){return i=a.scaledValue*Math.sin(b*(j.radians/h.length))}).attr("y",function(a,b){return k=-(a.scaledValue*Math.cos(b*j.radians/h.length))}).attr("transform","rotate(180)").text(function(a){return a.value}).attr("text-anchor",function(a,b){var c=360*(b/h.length);return 0>c||c>180?"end":"start"}).attr("dy",function(a,b){var c=360*(b/h.length);return 90>c||c>270?"1.25em":"-1.00em"}).style("fill-opacity",0)},o=function(){var b={values:g},d='{{#values}}<li id="li_{{id}}"><span style="background-color:{{color}}">&nbsp;</span> <input checked="checked" type="checkbox" name="checkbox_{{id}}" id="checkbox_{{id}}" value="{{id}}" /> <label for="checkbox_{{id}}">{{label}}</label></li>{{/values}}',e=Mustache.to_html(d,b);f.html(e),f.selectAll("input").on("change",function(){var a=this.value,b=this.checked?"block":"none";document.getElementById(a).style.display=b}),f.selectAll("li").on("mouseover",function(){c.selectAll("path").transition(200).style("fill-opacity",j.polyOpacityOff);var b=this.id.replace("li_",""),d=a.select(document.getElementById(b)),e=d.select("path"),f=d.selectAll(".nodeValue"),g=d.selectAll(".nodeLabel");e.transition(200).style("fill-opacity",j.polyOpacityOn),f.transition(200).style("fill-opacity",1),g.transition(200).style("fill-opacity",1)}).on("mouseout",function(){c.selectAll("path").transition(200).style("fill-opacity",j.polyOpacity);var b=this.id.replace("li_",""),d=a.select(document.getElementById(b)),e=d.select("path"),f=d.selectAll(".nodeValue"),g=d.selectAll(".nodeLabel");e.transition(200).style("fill-opacity",j.polyOpacityOff),f.transition(200).style("fill-opacity",0),g.transition(200).style("fill-opacity",0)})},p=function(){for(var a,b,c,e,f,j,k,l=[],m=[],n=0;n<d.length;n++){b=d[n],j=b.idannonce,k=b.label,m=[];for(var o in b)if(b.hasOwnProperty(o))for(var p=0;p<h.length;p++)f=h[p],f.id==="axis-"+o&&(c=b[o],c=parseFloat(c.replace(/\ /g,"")),e=f.scale(c),m.push({value:c,scaledValue:e}));l.push(m),a=new SelogerUI.AreaValues(m,i,n,j,k),g.push(a)}g.sort(function(a,b){return a.values.totalForProperty("scaledValue")>b.values.totalForProperty("scaledValue")?-1:a.values.totalForProperty("scaledValue")<b.values.totalForProperty("scaledValue")?1:0})},q=function(){for(var a,b,c,f=[],g=0;g<e.length;g++){f=[],a=e[g].label,b=e[g].dataField;for(var i=0;i<d.length;i++)f.push(d[i][b]);c=new SelogerUI.Axis(a,b,f,j.axisColor,j.canvasHeight/2-2*j.canvasPadding),h.push(c)}},r=function(a){return a&&(a.data||a.axis)?(a.data&&(d=a.data),a.axis&&(e=a.axis),c.remove(),h=[],q(),k(),o(),void 0):!1},s=function(c){return c&&c.container&&c.data&&c.axis?(c.config,c.controlsContainer&&(f=a.select(c.controlsContainer)),b=a.select(c.container).append("svg:svg"),b.attr("width",j.canvasWidth).attr("height",j.canvasHeight).attr("id","container"),d=c.data,e=c.axis,q(),p(),k(),o(),void 0):!1};return{init:s,update:r}}(d3);